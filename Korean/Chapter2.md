# Chapter2

## 2-1 Scalability 

Scalability는 확장성이라는 의미가 있습니다.
간단히 말씀드려서 얼마나 많은 일을 신속히 처리할 수 있는지를 뜻하는 거구요.
비트코인과 이더리움의 확장성의 문제가 많다고 해서 이더리움 같은 경우에는 빨리 이것을 해결하겠다 하는데, 얼마나 더 좋게 업그레이드되서 나올지는 미지수 입니다.

자, Scalability가 무엇인지, 왜 중요한 것인지 이야기를 해 보도록 하죠.
Scalability를 따질때는 TPS 와 Block interval 이라는 용어들을 사용하는데요 의미를 한번 보겟습니다.
TPS 는 Transation per Second 의 줄임말인데 초당 몇개의 트랜잭션, 즉 초당 몇개의 거래를 처리할 수 있는지 확인하는 거구요 블록인터벌은 블록 하나하나가 생길 때 어느 정도의 시간 간격을 두고 만들어지는가, 시간으로 나타내는 부분입니다.
우리가 블록체인의 초당 처리속도를 비자와 많이 비교하게 되는데요, VISA 가 초당 평균적으로 1700건의 트랜잭션을 처리하고 있다고 합니다. 비트코인 같은 경우에는 초당 7개의 처리할 수 있다고 하는데 현실적으로는 두개에서 다섯개 정도 나온다고 보면 되고요,
이더리움은 15에서 20 TPS 가 나온다고 합니다.
블록인터벌은 비트코인이 10분 이더리움이 15~20초 정도 나온다고 하구요.

자 그래서 만약 이더리움이 20TPS 로 블록인터벌이 15초 마다 나왔다고 하면
20곱하기 15 해서 총 300개의 트랜잭션이 한 블록에 들어가게 됩니다.

여기서 질문 하나를 드리겠습니다.
어떤 블록체인 플랫폼이 있는데 TPS 가 많이 나오고, 블록인터벌이 10분이면 사용자는 어떤 경험을 하게 될까요?

네 그렇습니다.
1초에 만개의 트랜잭션을 처리하는데 그 내용을 담은 블록이 완성되는 데까지는 최대 10분이 걸릴 수 있다는 뜻입니다.
이렇게 되면 어떻게 될까요?
나는 단순히 친구한테 돈 보내고 싶어서 송금 버튼을 눌렀는데, 완료 되기까지 재수 없으면 최대 10분까지 걸릴 수 있다는 뜻입니다.
말이 안되죠,
이더리움도 비트코인에 비해서는 확연히 줄어든 시간 이긴 하지만
15에서 20초도 솔직히 사용자 입장에서는 상당히 긴 시간입니다.
우리가 인터넷하면서 솔직히 5초이상 뭐가 진행이될때 안될때 벌써 짜증이 나잖아요. 21세기 에서는 벌어지면 안되는 헤프닝입니다.
그래서 왜 기존의 블록체인이 느린가에 대해서 한번 알아보도록 하죠. 먼저 블록체인 네트워크의 특성이 참여하는 노드가 많다고 해서 더 빨라지지는 않는다 라는 특징이 있습니다.
우리가 일반적으로 사용하는 웹서비스나 모바일 서비스는 사용자가 많아 짐에 따라 최대한 빨리 응답해 주기 위해서 서버를 증가시키고 또 다량의 리퀘스트가 들어오면 그 일들을 따로 분산해서 처리하게 됩니다.

그런데 블록체인 네트워크를 구성하는 노드라는 서버는 100개의 일이 들어오면 100개의 일을 분산하지 않고 100개의 일을 다 처리해야합니다.
즉 모든 노드들이 똑같은 일들을 반복한다는 거구요. 결과적으로는 전체 네트워크의 퍼포먼스가 제일 느린 노드에 맞게 하향평준화 된다는 점입니다.
컴퓨터 한대로 구성된 네트워크나 수만대로 구성된 네트워크나 퍼포먼스가 다르지 않다는 거죠. 
결과적으로는 기존의 비트코인이나 이더리움 같은 블록체인 네트워크는 많은 양의 트랜잭션을 처리하기에도 부족하고 네트워크 자체가 속도가 느리다는데에 있습니다. 

## 2-2 Finality 

Finality 는 변경 불가능한 최종적인 상태를 말합니다. 블록체인에서 블록이 파이널 하다는 것은 블록에 담긴 트랜잭션들이 절대로 바뀔 수 없다는 것을 보증하는 건데요. 

트랜잭션은 모호하지 않고 완료되었다 라고 믿어야 하는데, 비트코인과 이더리움의 마이닝 메커니즘은 이 최종성이 부족합니다. 

예를 들어서 제가 비트코인으로 비행기티켓을 하나 결제를 했어요. 그러면 그 순간 트랜잭션이 생성이 되겠죠. 기록에 남을 수 있는 거래가 생성이 된다는 뜻입니다. 

하지만 이 트랜잭션은 바로 처리가 되지않아요. 완벽한 보증은 아니지만 결국 처리가 될것이다 라는 확률론적 최종성만을 제공하는데요, 결제는 했지만 나중에 보면 결제가 안되어있을 수도 있다 라는 뜻입니다. Finality 까지 도달하는데 평균적으로 얼마나 걸리나 보도록 하겠습니다. 

이 테이블을 보시면 비트코인 같은 경우에는 파이널리티까지 도달하는 시간이 60분이라고 하죠. 블록채굴하는데는 10분이 걸리는데 (솔직히 이것도 너무 많아요.) 그런데 최종성에 도달하는데 6번의 검증을 거쳐서 1시간 이나 걸립니다. 너무 오래걸리죠. 이더리움은 최종성까지 6분이 걸린다고 하는데, 이것도 엄청 오래걸리는 겁니다. 이 검증단계를 많이 거칠수록 거래한 내용이 신뢰하기에 충분하다라고 판명이 나는건데, 하지만 이 검증단계를 몇번 거쳐야 하기 때문에 시간이 너무 오래걸립니다. 암호화폐가 이래서 상용화 되기가 어려운 거구요,결제한 다음에 최종상까지 걸리는 시간이 너무 비정상적 이에요. 얼마나 많은 사람이 1시간이나 기다려줄까요? 그래서 이 최종성이 중용한 역할을 하는거구요, 좀 어려운 말로는 이 Finality 는 트랜잭션이 변경 불가능하다는 합리적인 보장을 받기까지 얼마나 오래 기다려야 하는가를 측정합니다. 

마지막으로 블록체인 네트워크에서 오랜 시간 기다리는 것이 비즈니스에도 상당한 영향을 미칠 수 있기 때문에, 빨리 처리된 Finality 는 그만큼 중요한 비지니스적 자산입니다. 네 여기까지 현존하는 대표 블록체인 들의 파이널리티의 부재에 대해서 간략하게 설명해보았습니다. 
 
## 2-3 Fork

Fork는 블록들의 연결이 2개이상의 분기로 갈라지는 현상을 말합니다. Fork 가 발생하는 이유는 블록체인 P2P네트워크에서 모든 참여자들이 독립적으로 채굴할 수 있기 때문인데요, 

비트코인이나 이더리움의 작업 증명 방식을 살짝 설명을 해드리자면, 블록체인에 블록을 추가하기 위해서 어떤 문제를 풀게 하죠. 해시값을 찾아야 하는 문제인데 여러 노드들이 서로 경쟁을 하면서 먼저 문제를 풀려고 합니다. 

그런데 어쩌다가 두개의 노드에서 비슷한 시기에 문제를 풀게 됐어요. 그러면 블록체인에 추가될 후보자로 두개의 블록이 올라가게 됩니다.이때 바로 분기가 발생하게 되는거죠. 예를 들어서 두개의 노드에서 채굴을 한다고 가정을 합시다. A 와 B 노드라고 하고요. 어느날 제가 친구한테 송금을 했어요. 그럼 트랜잭션이 발생하고 트랜잭션 풀이라는 곳에 들어갑니다. 그러면 이 A B 노드에서 트랜잭션을 만들기 위해 트랜잭션 풀에 있는 트랜잭션 들을 블록에 담아요. 참고로 여기에는 제가 송금했다는 내용의 트랜잭션도 포함되어 있겠죠. 이제 이게 과정이 끝나면 노드 들이 각자가 만든 블록을 기존에 블록체인에 추가하기 위해서 문제를 풀어야 합니다. 

해시값을 찾는 연산 과정을 거쳐야 하는데, 어떻게 하다보니 AB 노드 둘다 문제를 풀었어요. 그러면 다른 노드 들에게 내가 풀었다고 다 이렇게 전파를 합니다. 자 이렇게 전파를 받았을 때 어떤 노드들은 A 노드에 블록을 받았고., 또 어떤 노드 들은 B 노드 블록을 받았습니다. 지금 이 세번째 순서에 블록에서 처럼 분기가 발생한 상태이죠. 그리고 편의상 A 노드 블록이 이 보라색이라고 하고, B 노드의 블록을 검정색이라고 하겠습니다. 전파 과정에서 먼저 보라색 블록을 받은 노드 들이 나중에는 검정색 블록도 받게 되요. 그런데 이 검정색 블록에 왔을 때 안받고 무시해 버립니다. 왜냐면 제가 친구한테 송금한 트랜잭션이 이미 보라색 블록에도 추가가 되었었기 때문이죠. 반대로 검정색 블록을 먼저 받은 노드들도 나중에 보라색 블록을 받게 될 때 동일한 트랜잭션이 포함되어 있어서 무시를 해버립니다. 그 다음으로 C  라는 노드에서 해시값 찾는 문제를 풀고 이 네번째 블록을 만들어서 다른 노드들에게 전파했습니다. 이때 네번째 블록을 만든 C 노드는 세번째 B 노드의 검정 블록을 먼저 받았던 노드에요. 자 그렇게 되면 세번째 검정 블록에 부모 해시를 가지고 있기 때문에 이 검정색 라인으로 추가가됩니다. 세번째 보라색 블록을 가지고 있던 노드들은 나중에 네번째 검정 블록이 도착 햇을 때 받을 수가 없습니다. 분명 문제를 풀어서 만들어진 유효한 블럭이고 또 블록 height(길이) 에 따라서 네번째 순서로 오는 블록인건 맞는데 받을 수가 없다는 거에요. 왜냐하면 네번째 블록에 부모 해시가 세번째 보라색 블록이 아니라 아래에 있는 검정색 블록이기 때문이죠. 자 이렇게 되면 이 보라색 블록을 받았던 노드들은 어떻게 해야할까요. 네 . 가지고 있었던 이 보라색 블록을 바로 버리고 다시 다운 받아서 세번째 검정색 블록부터 시작합니다. 그렇게 되면 이 검정색 라인이 계속 또 길어지게 되는거죠. 네 이렇게 분기 때 더 길게 형성된 라인이 결국 다음 블록으로 인정이 되고 블록체인에 추가가 되는 겁니다.
이게 바로 Longest 체인 룰 이라고 하고요. 분기가 되고 다시 한 라인으로 합쳐지는 과정들이 아주 자연스럽게 진행이 됩니다. 하지만 이 규칙을 악의적으로 사용할 수 있는 부분이 있어요. 예를 들어서 제가 전체 컴퓨팅 파워의 51% 이상을 가지고 있다면 다른 채굴자들에 비해 훨씬 더 빠르게 채굴할 수 있게 되고 더 많은 블록들을 만들어 낼 수 있게 됩니다. 이뜻은 분기의 과정에서 내가 만든 블록에 계속 라인을 이어나갈수 있게 되요. 예를 들어서 이 세번째 블록 때 분기가 형성이 됬죠. 제가 검정색 블록을 만들었어요. 그리고 네번째 블록을 기다려야하는데 다른 노드가 블록 만드는 걸 기다릴 필요가 없고 내가 만들어서 또 추가시키면 됩니다. 해싱파워가 더 써서 더 빨리 블록을 만들 수 있으니까요. 이런 식으로 나 혼자 라인을 다른 노드 들에게 전파를 안하고 몰래 계속 이어나갑니다. 이 과정에서 어떤 식으로 사기를 칠 수 있냐면 내 코인을 팔아서 현금화 시켰다는 내용을 블록에 안 넣을 수 도 있어요. 그리고 나서 전체 네트워크에 내 라인을 등장시키는 거죠. 결국에 분기 때 제일 긴 라인을 선택해서 해당 블록을 블록체인에 추가하는 룰이기 때문에 이렇게 되면 내 라인이 더 기니까 내 라인이 선택이 되고 사기쳤던 블록이 블록체인에 합법적으로 추가가 되는 겁니다. 

네 정리를 하자면 이런 식으로 네트워크를 망가트릴 수 있는 가능성이 있다라는 거구요. 또 이 분기가 발생할 때마다 누구 라인이 더 기나 검증 단계를 거쳐야 해서, Finality까지 시간이 오래 걸린다는 것 또한 단점입니다.

